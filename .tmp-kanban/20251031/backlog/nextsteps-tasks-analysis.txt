Today is UTC `date -u '+%Y-%m-%dT%H:%M:%SZ` 2025-10-31

> Yesterday(2025-10-30 UTC) DEV-Team å®Œæˆäº† "DSCAgent"é¡¹ç›® v 0.1.0 mvp ç›®æ ‡çš„ M2 milestone -  
"T-02-01-graph-builder" çš„ DEV-COOKING Tasks:
@.artifacts/spec-tasks-T-02-01-graph-builder/metadata.yaml
@spacs/tasks/0.1.0-mvp/TODO.yaml 
  # ==================== Phase 2: Core Indexing (Week 2-3) ====================

  T-02-01-graph-builder:
    title: "Graph Builder - AST Parsing & Construction"
    milestone: M2
    week: 2
    priority: P0
    status: completed
    owner: Rust Dev 1
    duration_days: 6  # Completed in 6 days (2025-10-24 to 2025-10-30)
    worktree: .worktrees/T-02-01-graph-builder
    branch: feat/task/T-02-01-graph-builder
    symlink: ~/dev-space/CDSAgent-T-02-01-graph-builder
    completed_date: "2025-10-30"
    pr: "https://github.com/lwyBZss8924d/CDSAgent/pull/6"

    specs:
      prds:
        - spacs/prd/0.1.0-MVP-PRDs-v0/02-cds-index-service.md
        - spacs/prd/0.1.0-MVP-PRDs-v0/06-rust-refactoring-plan.md
      issues:
        - spacs/issues/04-0.1.0-mvp/02-index-core/01-graph-build.md
      tasks:
        - spacs/tasks/0.1.0-mvp/02-index-core/T-02-01-graph-builder.md

    dependencies:
      requires:
        - T-06-01-parity-methodology
      blocks:
        - T-02-02-sparse-index
        - T-03-01-core-commands

    deliverables:
      - crates/cds-index/src/graph/parser.rs
      - crates/cds-index/src/graph/builder/ (10 modules, 2,037 lines)
      - crates/cds-index/src/graph/traversal.rs
      - crates/cds-index/tests/graph_builder_tests.rs (23 unit tests)
      - crates/cds-index/tests/graph_parity_tests.rs (6 fixtures validation)
      - API documentation (crates/cds-index/src/graph/mod.rs)

    acceptance_criteria:
      - "âœ… Parses Python repos with 4 node types + 4 edge types"
      - "âœ… Fully-qualified names match LocAgent format"
      - "âœ… Unit tests cover edge cases (23 tests, ~82% coverage)"
      - "âœ… Graph parity â‰¤2% variance (all 6 fixtures pass)"

    worklog_path: .artifacts/spec-tasks-T-02-01-graph-builder/worklogs/

    git_commits:
      - cd863be: "checkpoint(worklog): T-02-01 Day 6 - initialize 2025-10-30 session worklogs"
      - 72f9db5: "feat(graph): T-02-01 complete - parity, coverage, docs"
      - c0b8f2c: "checkpoint(worklog): T-02-01 Day 6 complete"
      - af5a537: "chore(config): update Claude auto-approval settings for checkpoint workflow"

    metrics:
      estimated_hours: 40
      actual_hours: 39
      lines_added: 8884
      lines_deleted: 353
      files_modified: 74
      tests_added: 23
      test_coverage: 0.82
      parity_variance_max: 0.0129  # +1.29% on pytest invokes

  T-02-02-sparse-index:
    title: "Sparse Index - Name/ID + BM25 Search"
    milestone: M2
    week: 2
    priority: P0
    status: not_started
    owner: Rust Dev 2
    duration_days: 4
    worktree: .worktrees/T-02-02-sparse-index
    branch: feat/task/T-02-02-sparse-index
    symlink: ~/dev-space/CDSAgent-T-02-02-sparse-index

    specs:
      prds:
        - spacs/prd/0.1.0-MVP-PRDs-v0/02-cds-index-service.md
      issues:
        - spacs/issues/04-0.1.0-mvp/02-index-core/02-sparse-index.md
      tasks:
        - spacs/tasks/0.1.0-mvp/02-index-core/T-02-02-sparse-index.md

    dependencies:
      requires:
        - T-02-01-graph-builder
      blocks:
        - T-02-03-service-layer
        - T-03-01-core-commands

    deliverables:
      - crates/cds-index/src/index/name_index.rs
      - crates/cds-index/src/index/bm25.rs
      - Performance benchmarks (<500ms p95 search latency)

    acceptance_criteria:
      - Upper index (name/ID HashMap) with prefix matching
      - Lower index (BM25 k1=1.5, b=0.75)
      - Search latency <500ms p95
      - Index build <5s for 1K files

    worklog_path: .artifacts/spec-tasks-T-02-02/worklogs/

  T-02-04-serialization:
    title: "Graph & Index Serialization"
    milestone: M2
    week: 3
    priority: P1
    status: not_started
    owner: Rust Dev 2
    duration_days: 2
    worktree: .worktrees/T-02-02-sparse-index  # Same worktree
    branch: feat/task/T-02-02-sparse-index

    specs:
      issues:
        - spacs/issues/04-0.1.0-mvp/02-index-core/04-serialization-fixtures.md
      tasks:
        - spacs/tasks/0.1.0-mvp/02-index-core/T-02-04-serialization.md

    dependencies:
      requires:
        - T-02-01-graph-builder
        - T-02-02-sparse-index
      blocks:
        - T-03-03-integration-tests
        - T-07-02-env-config

    deliverables:
      - crates/cds-index/src/persistence/
      - Test fixtures under tests/fixtures/
---
- (.artifacts/spec-tasks-T-02-01-graph-builder/metadata.yaml)
- (spacs/tasks/0.1.0-mvp/TODO.yaml)
- (spacs/tasks/0.1.0-mvp/README.md)
- (spacs/issues/04-0.1.0-mvp/README.md)
- (spacs/issues/04-0.1.0-mvp/02-index-core/00-overview.md)
- (spacs/issues/04-0.1.0-mvp/02-index-core/01-graph-build.md)
- (spacs/issues/04-0.1.0-mvp/02-index-core/02-sparse-index.md)
- (spacs/issues/04-0.1.0-mvp/02-index-core/03-service-layer.md)
- (spacs/issues/04-0.1.0-mvp/02-index-core/04-serialization-fixtures.md)
- (spacs/prd/0.1.0-MVP-PRDs-v0/02-cds-index-service.md)

```shell
CDSAgent main*â€‹ â‰¡
â¯ cd crates/                            

CDSAgent/crates main*â€‹ â‰¡
â¯ tree                                     
.
â”œâ”€â”€ cds-index
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â”œâ”€â”€ benches
â”‚   â”‚   â”œâ”€â”€ graph_bench.rs
â”‚   â”‚   â””â”€â”€ search_bench.rs
â”‚   â”œâ”€â”€ src
â”‚   â”‚   â”œâ”€â”€ bin
â”‚   â”‚   â”‚   â””â”€â”€ cds-index-service.rs
â”‚   â”‚   â”œâ”€â”€ config.rs
â”‚   â”‚   â”œâ”€â”€ graph
â”‚   â”‚   â”‚   â”œâ”€â”€ GraphBuilder-Refactoring-Plan.txt
â”‚   â”‚   â”‚   â”œâ”€â”€ builder
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ aliases.rs
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ behaviors.rs
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ imports.rs
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ language.rs
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ python
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ast_utils.rs
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ call_extractor.rs
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ import_resolver.rs
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ mod.rs
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ state.rs
â”‚   â”‚   â”‚   â”œâ”€â”€ builder_backup.rs
â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”‚   â”œâ”€â”€ parser.rs
â”‚   â”‚   â”‚   â””â”€â”€ traversal.rs
â”‚   â”‚   â”œâ”€â”€ index
â”‚   â”‚   â”‚   â”œâ”€â”€ bm25.rs
â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”‚   â””â”€â”€ name_index.rs
â”‚   â”‚   â”œâ”€â”€ lib.rs
â”‚   â”‚   â”œâ”€â”€ persistence
â”‚   â”‚   â”‚   â””â”€â”€ mod.rs
â”‚   â”‚   â””â”€â”€ service
â”‚   â”‚       â”œâ”€â”€ handlers.rs
â”‚   â”‚       â”œâ”€â”€ mod.rs
â”‚   â”‚       â””â”€â”€ server.rs
â”‚   â””â”€â”€ tests
â”‚       â”œâ”€â”€ graph_builder_tests.rs
â”‚       â”œâ”€â”€ graph_parity_tests.rs
â”‚       â”œâ”€â”€ integration_test.rs
â”‚       â””â”€â”€ service_contract_tests.rs
â””â”€â”€ cds-tools
    â”œâ”€â”€ Cargo.toml
    â””â”€â”€ src
        â”œâ”€â”€ client
        â”‚   â””â”€â”€ mod.rs
        â”œâ”€â”€ commands
        â”‚   â”œâ”€â”€ mod.rs
        â”‚   â”œâ”€â”€ retrieve.rs
        â”‚   â”œâ”€â”€ search.rs
        â”‚   â””â”€â”€ traverse.rs
        â”œâ”€â”€ formatters
        â”‚   â”œâ”€â”€ json.rs
        â”‚   â”œâ”€â”€ mod.rs
        â”‚   â”œâ”€â”€ text.rs
        â”‚   â””â”€â”€ tree.rs
        â””â”€â”€ main.rs

17 directories, 43 files
```

```shell
CDSAgent main*â€‹ â‰¡
â¯ cd .artifacts/spec-tasks-T-02-01-graph-builder/

CDSAgent/.artifacts/spec-tasks-T-02-01-graph-builder main*â€‹ â‰¡
â¯ tree
.
â”œâ”€â”€ git-refs.txt
â”œâ”€â”€ metadata.yaml
â””â”€â”€ worklogs
    â”œâ”€â”€ 2025-10-24-commit-log.md
    â”œâ”€â”€ 2025-10-24-notes.md
    â”œâ”€â”€ 2025-10-24-work-summary.md
    â”œâ”€â”€ 2025-10-25-commit-log.md
    â”œâ”€â”€ 2025-10-25-notes.md
    â”œâ”€â”€ 2025-10-25-work-summary.md
    â”œâ”€â”€ 2025-10-27-commit-log.md
    â”œâ”€â”€ 2025-10-27-notes.md
    â”œâ”€â”€ 2025-10-27-work-summary.md
    â”œâ”€â”€ 2025-10-28-commit-log.md
    â”œâ”€â”€ 2025-10-28-notes.md
    â”œâ”€â”€ 2025-10-28-work-summary.md
    â”œâ”€â”€ 2025-10-29-commit-log.md
    â”œâ”€â”€ 2025-10-29-notes.md
    â”œâ”€â”€ 2025-10-29-work-summary.md
    â”œâ”€â”€ 2025-10-30-TODOs-Plan.txt
    â”œâ”€â”€ 2025-10-30-commit-log.md
    â”œâ”€â”€ 2025-10-30-notes.md
    â”œâ”€â”€ 2025-10-30-work-summary.md
    â””â”€â”€ raw
        â”œâ”€â”€ DEVCOOKING-WORK-ACTIONSLOGS-2025-10-25-01.txt
        â”œâ”€â”€ DEVCOOKING-WORK-ACTIONSLOGS-2025-10-27-01.txt
        â”œâ”€â”€ DEVCOOKING-WORK-ACTIONSLOGS-2025-10-28-01.txt
        â”œâ”€â”€ DEVCOOKING-WORK-ACTIONSLOGS-2025-10-29-01.txt
        â”œâ”€â”€ DEVCOOKING-WORK-ACTIONSLOGS-2025-10-30-01.txt
        â”œâ”€â”€ DEVCOOKING-WORK-ACTIONSLOGS-2025-10-30-02.txt
        â”œâ”€â”€ DEVCOOKING-WORK-ACTIONSLOGS-2025-10-30-03.txt
        â”œâ”€â”€ DEVCOOKING-WORK-ACTIONSLOGS-2025-10-30-04.txt
        â”œâ”€â”€ DEVCOOKING-WORK-ACTIONSLOGS-2025-10-30-05.txt
        â”œâ”€â”€ DEVCOOKING-WORK-START-2025-10-24-04.txt
        â””â”€â”€ DEVCOOKING-WORK-START-PLAN-2025-10-30.txt

3 directories, 32 files

```

---
@docs/NEXT_TASK_CHECKLIST.md

âº æˆ‘åˆæ­¥åˆ†æäº†å½“å‰ Codebase - PRDs / Issues / Tasks , Next DEV-COOKING Phase åº”è¯¥æ‰§è¡Œçš„ Tasks & ä¾èµ– ï¼š

  T-02-02-sparse-index ä¾èµ–åˆæ­¥åˆ†æ

  âœ… ä¾èµ–çŠ¶æ€æ£€æŸ¥

  T-02-02 çš„ä¾èµ–è¦æ±‚:
  - requires: T-02-01-graph-builder

  T-02-01 çŠ¶æ€éªŒè¯:
  - âœ… status: completed
  - âœ… PR #6: MERGED (2025-10-30T08:21:47Z)
  - âœ… æ‰€æœ‰ worktrees: å·²åŒæ­¥åˆ°æœ€æ–° main (commit 2a2ad34)

  ğŸ“Š M2 é‡Œç¨‹ç¢‘ä»»åŠ¡çŠ¶æ€

  M2 å…³é”®è·¯å¾„ (critical_path):
  1. âœ… T-02-01-graph-builder - å·²å®Œæˆå¹¶åˆå¹¶
  2. â³ T-02-02-sparse-index - ä¾èµ–å·²æ»¡è¶³ï¼Œå¯ä»¥å¼€å§‹

  M2 å…¶ä»–ä»»åŠ¡:
  - T-02-04-serialization: éœ€è¦ç­‰å¾… T-02-02 å®Œæˆï¼ˆrequires T-02-01 + T-02-02ï¼‰

  ğŸ¯ ä¸‹ä¸€æ­¥ä»»åŠ¡åˆæ­¥åˆ†æ

  æ ¹æ® NEXT_TASK_CHECKLIST.md çš„å†³ç­–æµç¨‹åˆæ­¥åˆ†æï¼š

  1. Check Milestone Status âœ…
  - å½“å‰é‡Œç¨‹ç¢‘: M2 (Core Indexing Prototype)
  - ç›®æ ‡æ—¥æœŸ: 2025-11-09
  - çŠ¶æ€: not_started â†’ åº”æ›´æ–°ä¸º in_progress

  2. List Candidate Tasks âœ…
  - M2 ä¸­æœªå¼€å§‹çš„ä»»åŠ¡: T-02-02, T-02-04

  3. Verify Dependencies âœ…
  - T-02-02: æ‰€æœ‰ä¾èµ–å·²æ»¡è¶³ (T-02-01 âœ… MERGED)
  - T-02-04: ä¾èµ–æœªæ»¡è¶³ (éœ€è¦ T-02-02)

  4. Apply Priority Filter âœ…
  - T-02-02: P0 (Critical), åœ¨ critical_path ä¸Š
  - T-02-04: P1 (Important)

  5. Final Verification âœ…
  - Task specification exists:
  spacs/tasks/0.1.0-mvp/02-index-core/T-02-02-sparse-index.md
  - All dependencies MERGED: T-02-01 PR #6 å·²åˆå¹¶
  - Main branch synced: æ‰€æœ‰ worktrees å·²åŒæ­¥åˆ° 2a2ad34
  - Time until deadline: 10 å¤© (è‡³ 2025-11-09)
  - Resources available: Graph API å¯ç”¨, parity baselines å¯ç”¨

  ---
  âœ… åˆæ­¥åˆ†æåˆ¤æ–­ï¼šä¸‹ä¸€ä¸ªä»»åŠ¡æ˜¯ T-02-02-sparse-index

  åˆæ­¥ç†ç”±

  1. ä¾èµ–å·²æ¸…é™¤: T-02-01 å·²å®Œæˆå¹¶åˆå¹¶ (PR #6)
  2. å…³é”®è·¯å¾„ä»»åŠ¡: M2 milestone çš„ç¬¬äºŒä¸ª critical_path ä»»åŠ¡
  3. ä¼˜å…ˆçº§æœ€é«˜: P0 + é˜»å¡å…¶ä»–ä»»åŠ¡ (T-02-03, T-03-01, T-02-04)
  4. å¼€å‘ç¯å¢ƒå°±ç»ª: Worktree å·²åŒæ­¥ï¼ŒGraph API å¯ç”¨
  5. èµ„æºé½å…¨:
    - Graph builder å®ç°å¯å‚è€ƒ (crates/cds-index/src/graph/)
    - 6 ä¸ª parity baselines å¯ç”¨äºæµ‹è¯•
    - LocAgent å‚è€ƒå®ç°å¯ç”¨ (tmp/LocAgent/)

  ä»»åŠ¡å…³é”®ä¿¡æ¯

  T-02-02-sparse-index:
  - ä¼°è®¡æ—¶é—´: 4 å¤©
  - ä¼˜å…ˆçº§: P0 (Critical)
  - Worktree: ~/dev-space/CDSAgent-T-02-02-sparse-index (å·²åŒæ­¥åˆ° 2a2ad34)
  - äº¤ä»˜ç‰©:
    - Upper index: Name/ID HashMap with prefix matching
    - Lower index: BM25 (k1=1.5, b=0.75)
    - Performance benchmarks
  - éªŒæ”¶æ ‡å‡†:
    - Search latency <500ms p95
    - Index build <5s for 1K files
  - é˜»å¡ä»»åŠ¡: T-02-03 (service layer), T-03-01 (CLI commands), T-02-04
  (serialization)

  Next Steps

  æŒ‰ç…§ NEXT_TASK_CHECKLIST.md Phase 3 æµç¨‹ï¼š

  # 1. ç¡®è®¤ worktree å·²åŒæ­¥ (- [] TODO å¦‚æœå°šæœªä¸ main åŒæ­¥æœ€æ–°å¼€å‘ç¯å¢ƒ)
  cd ~/dev-space/CDSAgent-T-02-02-sparse-index
  git log -1 --oneline

  # 2. åˆ‡æ¢ Tasks å¼€å‘ç¯å¢ƒè‡³ worktree å¯¹åº” tree & branch

  # 3. æ£€æŸ¥ worktree å¼€å‘ç¯å¢ƒ & åˆå§‹åŒ–ä»»åŠ¡ artifacts (- [] TODO å¦‚æœå°šæœªåˆå§‹åŒ–)
  - docs/WORKTREE_WORKFLOW.md
  - docs/WORK_SESSION_CHECKPOINT_WORKFLOW.md
  - worktree: .artifacts/spec-tasks-T-xx-xx-xxxx/ (metadata.yaml) (../worklogs/ YYYY-MM-DD-work-summary.md , YYYY-MM-DD-notes.md YYYY-MM-DD-commit-log.md ), (../worklogs/raw/ DEVCOOKING-WORK-START init txt and sessions threads summary worklog init txt )
  /Users/arthur/dev-space/CDSAgent/scripts/create-task-worklog.sh \
    T-02-02-sparse-index \
    "Sparse Index - Name/ID + BM25 Search" \
    "Rust Dev 2"

  # 4. Planing Tasks Sessions Phase TODOs and Init åˆ›å»ºä»Šæ—¥(UTC) worklog
  - `â¯ date -u '+%Y-%m-%dT%H:%M:%SZ'`
  - worktree: .artifacts/spec-tasks-T-xx-xx-xxxx/ (metadata.yaml) (../worklogs/ YYYY-MM-DD-work-summary.md , YYYY-MM-DD-notes.md YYYY-MM-DD-commit-log.md ), (../worklogs/raw/ DEVCOOKING-WORK-START init txt and sessions threads summary worklog init txt )
  /Users/arthur/dev-space/CDSAgent/scripts/create-daily-worklog.sh
  T-02-02-sparse-index

  # 5. é˜…è¯» PRDs / Issues / Tasksä»»åŠ¡è§„èŒƒ

  # 6. åˆ†æå½“å‰ Codebase ä»£ç å®ç°çŠ¶æ€, æ ¹æ® PRDs / Issues / Tasks ç ”ç©¶å¼€å‘ç¼–ç å®æ–½è®¡åˆ’

  # 7. Let's DEV COOKING!

âº Plan:
â•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œ
 T-02-02-sparse-index Implementation Plan

 âœ… TASK SELECTION VALIDATED

 Status: READY TO START (All dependencies cleared)

 Dependency Verification

 - âœ… T-02-01-graph-builder: COMPLETED and MERGED
   - PR #6 merged: 2025-10-30T08:21:47Z
   - Latest commit: 2a2ad34
   - All parity tests passing (â‰¤2% variance)
   - Graph API fully documented and stable
 - âœ… Worktree Environment: EXISTS and SYNCED
   - Worktree: .worktrees/T-02-02-sparse-index @ 2a2ad34
   - Branch: feat/task/T-02-02-sparse-index
   - Symlink: ~/dev-space/CDSAgent-T-02-02-sparse-index âœ…
   - Needs: Artifacts initialization (metadata.yaml not found)
 - âœ… Resources Available:
   - 6 parity baselines in tests/fixtures/parity/golden_outputs/
   - 50 search queries in search_queries.jsonl
   - Graph API: crates/cds-index/src/graph/mod.rs
   - LocAgent reference: tmp/LocAgent/plugins/location_tools/retriever/bm25_retriever.py

 ---
 IMPLEMENTATION APPROACH

 Phase 1: Environment Setup (30 min)

 1. Navigate to T-02-02 worktree: cd ~/dev-space/CDSAgent-T-02-02-sparse-index
 2. Initialize task artifacts: ../scripts/create-task-worklog.sh T-02-02-sparse-index "Sparse Index 
 - Name/ID + BM25 Search" "Rust Dev 2"
 3. Create today's worklog: ../scripts/create-daily-worklog.sh T-02-02-sparse-index
 4. Read task specifications:
   - spacs/tasks/0.1.0-mvp/02-index-core/T-02-02-sparse-index.md
   - spacs/issues/04-0.1.0-mvp/02-index-core/02-sparse-index.md
   - spacs/prd/0.1.0-MVP-PRDs-v0/02-cds-index-service.md (Â§2.2)

 Phase 2: Upper Index - Name/ID Lookup (Days 1-2)

 Deliverable: crates/cds-index/src/index/name_index.rs

 Design (from Issue 02-sparse-index.md):
 pub struct NameIndex {
     exact_map: HashMap<String, Vec<NodeID>>,  // name â†’ entity IDs
     sorted_keys: Vec<String>,                  // for prefix search
 }

 Key Features:
 - âœ… Exact match: O(1) average case
 - âœ… Prefix match: sorted keys binary search
 - âœ… Entity type filtering (Directory/File/Class/Function)
 - âœ… Case-insensitive option

 Integration:
 // Use Graph API from T-02-01
 use cds_index::graph::{DependencyGraph, GraphNode, NodeKind};

 // Build index from graph
 for (idx, node) in graph.nodes() {
     if matches!(node.kind, NodeKind::Class | NodeKind::Function) {
         index.insert(node.display_name.clone(), idx);
     }
 }

 Testing:
 - Unit tests for exact/prefix matching
 - Type filtering validation
 - Case sensitivity tests

 ---
 Phase 3: BM25 Lower Index (Days 3-5)

 Deliverables:

 - crates/cds-index/src/index/bm25.rs
 - crates/cds-index/src/index/tokenizer.rs

 Decision Point: Tantivy vs Custom BM25

 Option A: Tantivy (Recommended - start here)
 // Use tantivy crate (production-ready BM25)
 use tantivy::{Index, IndexWriter, schema::*, collector::TopDocs};

 pub struct BM25Index {
     index: tantivy::Index,
     schema: Schema,
 }

 Pros:
 - âœ… Battle-tested BM25 implementation
 - âœ… k1=1.5, b=0.75 parameters built-in
 - âœ… Fast indexing and search
 - âœ… On-disk persistence

 Cons:
 - âš ï¸ Tokenization may differ from LocAgent
 - âš ï¸ Need to verify parity (50 queries, â‰¥90% overlap@10)

 Option B: Custom BM25 (Fallback if Tantivy parity <85%)
 pub struct CustomBM25 {
     inverted_index: HashMap<String, Vec<Posting>>,
     k1: f32,  // 1.5
     b: f32,   // 0.75
 }

 Implementation Strategy:
 1. Day 3: Prototype both Tantivy and Custom BM25
 2. Day 4: Run parity tests on 50 queries (from search_queries.jsonl)
 3. Decision: Use Tantivy if overlap â‰¥90%, else Custom BM25

 Tokenizer Requirements (from LocAgent):
 // Match LocAgent tokenization:
 // - camelCase splitting: "AuthService" â†’ ["Auth", "Service"]
 // - snake_case splitting: "auth_service" â†’ ["auth", "service"]
 // - English stemming (Stemmer.Stemmer("english"))
 // - Stop words removal

 LocAgent Reference:
 - tmp/LocAgent/plugins/location_tools/retriever/bm25_retriever.py (line 105-113)
   - Uses llama_index.retrievers.bm25.BM25Retriever
   - Stemmer: Stemmer.Stemmer("english")
   - Parameters: similarity_top_k=10

 ---
 Phase 4: Hierarchical Search Strategy (Day 6)

 Deliverable: crates/cds-index/src/index/mod.rs

 Search Flow (from PRD-02 FR-HI-3):
 1. Query arrives: "sanitize user input"
 2. Try Upper Index (name/ID): exact/prefix match
    â†’ Found â‰¥5 results? Return upper results
 3. If upper < 5: Fallback to BM25
    â†’ Search content with BM25
 4. Merge & deduplicate
 5. Return top-K (K=10 default)

 Implementation:
 pub struct HierarchicalSearcher<'a> {
     name_index: NameIndex,
     bm25_index: BM25Index,
     graph: &'a DependencyGraph,
 }

 pub struct SearchOptions {
     limit: usize,              // Default: 10
     entity_type: Option<NodeKind>,
     upper_threshold: usize,    // Default: 5
 }

 Key Logic:
 - Upper index = score 1.0 (exact match highest priority)
 - BM25 = score 0.0-1.0 (ranked by BM25 score)
 - Sort by score descending
 - Deduplicate entities

 ---
 Phase 5: Benchmarking & Parity (Days 7-8)

 Deliverables:

 - crates/cds-index/benches/search_bench.rs
 - crates/cds-index/tests/index_tests.rs
 - crates/cds-index/tests/search_parity_tests.rs

 Performance Targets (from PRD-02):
 - âœ… Upper index lookup: <10ms
 - âœ… BM25 search: <500ms p95 (10K files)
 - âœ… Memory: <500MB for 10K files
 - âœ… Index build: <5s for 1K files

 Parity Validation (from Issue 02-sparse-index.md):
 // Load 50 benchmark queries
 let queries = load_queries("tests/fixtures/parity/golden_outputs/search_queries.jsonl");

 // For each query:
 // 1. CDS results (our implementation)
 // 2. LocAgent baseline (from jsonl)
 // 3. Calculate overlap@10
 // 4. Assert avg_overlap â‰¥ 90%

 Acceptance Criteria:
 - âœ… Hierarchical search: Top-10 overlap â‰¥90% with LocAgent
 - âœ… Unit test coverage >95%
 - âœ… All benchmarks pass
 - âœ… cargo clippy zero warnings

 ---
 TECHNICAL RISKS & MITIGATION

 Risk 1: Tokenization Mismatch

 Problem: Tantivy's default tokenization differs from LocAgent
 Mitigation:
 - Implement custom tokenizer matching LocAgent's camelCase/snake_case splitting
 - Use Tantivy's TextAnalyzer with custom Tokenizer

 Risk 2: BM25 Parameter Tuning

 Problem: k1=1.5, b=0.75 may not achieve 90% overlap
 Mitigation:
 - Test different parameter combinations
 - Document parity results in spacs/issues/04-0.1.0-mvp/06-refactor-parity.md

 Risk 3: Memory Usage for Large Repos

 Problem: In-memory BM25 may exceed 500MB for 10K files
 Mitigation:
 - Use Tantivy's on-disk storage (mmap)
 - Benchmark with largest parity fixture (Django: 6,876 nodes)

 ---
 NEXT STEPS (Execution Order)

 1. Verify worktree sync: cd ~/dev-space/CDSAgent-T-02-02-sparse-index && git log -1
 2. Initialize artifacts: ../scripts/create-task-worklog.sh T-02-02-sparse-index "Sparse Index - 
 Name/ID + BM25 Search" "Rust Dev 2"
 3. Create daily worklog: ../scripts/create-daily-worklog.sh T-02-02-sparse-index
 4. Read specifications: Review task spec, issue, and PRD sections
 5. Day 1-2: Implement Upper Index (name_index.rs)
 6. Day 3: Prototype Tantivy + Custom BM25
 7. Day 4: Run 50-query parity test, choose implementation
 8. Day 5: Complete BM25 implementation
 9. Day 6: Implement hierarchical search
 10. Day 7-8: Benchmarking, parity validation, testing
 11. Create PR: Document parity results, request review

 ---
 ESTIMATED COMPLETION

 - Original estimate: 4 days
 - Realistic estimate: 6-8 days (includes parity validation)
 - Complexity: 7/10 (BM25 implementation + parity requirement)
 - Key challenge: Achieving â‰¥90% search overlap with LocAgent

 ---
 RECOMMENDATION: START IMMEDIATELY - This is the critical path blocker for T-02-03 (Service Layer)
 and T-03-01 (CLI Commands).
â•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œâ•Œ  
