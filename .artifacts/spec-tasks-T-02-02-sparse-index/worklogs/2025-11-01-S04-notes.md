# Development Notes - 2025-11-01 Session 04

**Task**: T-02-02-sparse-index
**Session**: 04 (Phase 2: Custom Tokenizer - Planning & Prep)
**Date**: 2025-11-01

---

## Technical Notes

### Session 04 Planning Checklist

Planning Tasks:

- [ ] Review metadata acceptance matrix for remaining criteria
- [ ] Extract tokenizer requirements from LocAgent + PRD-02/06
- [ ] Document Tantivy/BM25 schema + index storage expectations
- [ ] Outline parity validation strategy (overlap@10 ≥90%)
- [ ] Update TODO roster for Session 04 implementation threads

Open Risks to Monitor:

- Tokenizer parity (camel/snake split, stop words, stemming)
- BM25 analyzer configuration (tantivy pipeline vs custom)
- Benchmark fixture fidelity for Phase 5 overlap testing

---

## Architecture Decisions

[To be documented as decisions are made during planning and implementation]

---

## Implementation Details

### Phase 2: Custom Tokenizer

**Requirements from LocAgent**:

- [To be extracted from tmp/LocAgent/repo_index/]
- Camel/snake case splitting
- Stop word filtering
- Stemming (if applicable)

**Parity Strategy**:

- [To be defined based on LocAgent analysis]

---

## Testing Strategy

[To be defined based on Phase 2 requirements]

---

## Performance Notes

### Current Baselines (from Session 03)

| Operation | Median | Target | Status |
|-----------|--------|--------|--------|
| Exact match | 68.42 ns | <10ms | ✅ |
| Prefix match | 699.40 ns | <10ms | ✅ |
| Index build (1,024) | 2.287 ms | <5s | ✅ |

### Phase 2 Performance Targets

[To be defined for tokenizer operations]

---

## Code Review Notes

[To be documented as code is written]

---

## Debugging Notes

[To be documented as issues arise]

---

## TODO / Follow-up

### Immediate (Phase 2 - Tokenizer)

- [ ] Extract LocAgent stop-word list → `tests/fixtures/parity/tokenizer/stop_words.txt`
- [ ] Create `tests/support/parity_loader.rs` helper module
- [ ] Implement tokenizer.rs with camel/snake splitting
- [ ] Golden tokenizer fixtures for validation

### Near-term (Phase 3 - BM25)

- [ ] Define `TANTIVY_DATA_DIR` env var + config
- [ ] Integrate Tantivy with custom analyzer
- [ ] Create `BM25Backend` trait for pluggability
- [ ] Wire hierarchical search (upper → lower tier)

### Future (Phase 5 - Parity)

- [ ] Replace synthetic benchmark data with parity fixtures
- [ ] Measure overlap@10 against LocAgent baselines
- [ ] Tune BM25 parameters (k1, b) if needed

---

## References

- **PRD**: spacs/prd/0.1.0-MVP-PRDs-v0/02-cds-index-service.md (Section 3.2: Index Architecture)
- **PRD**: spacs/prd/0.1.0-MVP-PRDs-v0/06-rust-refactoring-plan.md (Tokenizer parity)
- **Issue**: spacs/issues/04-0.1.0-mvp/02-index-core/02-sparse-index.md
- **Task**: spacs/tasks/0.1.0-mvp/02-index-core/T-02-02-sparse-index.md
- **LocAgent Reference**: tmp/LocAgent/repo_index/ (tokenizer implementation)
- **Parity baseline**: tests/fixtures/parity/golden_outputs/ (T-06-01 deliverable)

---

## Session Statistics

- **Session Duration**: TBD
- **Productivity**: TBD
- **Blockers**: None (currently)
- **Code Quality**: TBD
- **Technical Debt**: TBD

---

**Last Updated**: 2025-11-01 01:39 UTC (Session 04 kickoff)
**Next Session**: TBD (Phase 2 implementation or Phase 3)
