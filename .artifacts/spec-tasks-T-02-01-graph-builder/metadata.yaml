# Task Metadata - T-02-01 Graph Builder

task:
  id: "T-02-01-graph-builder"
  title: "Graph Builder - AST Parsing & Construction"
  status: "in_progress"  # not_started | in_progress | blocked | completed
  priority: "P0"
  milestone: "M2"
  week: 2
  duration_days: 5

owner:
  primary: "Rust Dev 1"
  secondary: ["Refactor Parity Lead"]

dates:
  started: "2025-10-24"
  target_completion: "2025-10-30"  # 5 business days from start
  actual_completion: null

specs:
  prds:
    - "spacs/prd/0.1.0-MVP-PRDs-v0/02-cds-index-service.md"
    - "spacs/prd/0.1.0-MVP-PRDs-v0/06-rust-refactoring-plan.md"
  issues:
    - "spacs/issues/04-0.1.0-mvp/02-index-core/01-graph-build.md"
  tasks:
    - "spacs/tasks/0.1.0-mvp/02-index-core/T-02-01-graph-builder.md"

git:
  worktree: ".worktrees/T-02-01-graph-builder"
  branch: "feat/task/T-02-01-graph-builder"
  symlink: "~/dev-space/CDSAgent-T-02-01-graph-builder"
  commits:
    - hash: "f0e4858"
      message: "docs(task): T-02-01 - initialize task artifacts and Day 1 spec review"
      date: "2025-10-24"
      files_changed: 5
    - hash: "82936fa"
      message: "feat(graph): T-02-01 - implement core graph builder with AST parsing and edge resolution"
      date: "2025-10-25"
      files_changed: 16
      notes: "Core implementation: parser (426 lines), builder (1040 lines), traversal (64 lines), tests (232 lines). Total +4,265 lines."
    - hash: "00da9c2"
      message: "feat(graph): T-02-01 - add parity harness and refine import resolution"
      date: "2025-10-25"
      files_changed: 5
      notes: "Parity harness (359 lines), builder AST refinement (+159 lines). Current variance: imports +23.85%, invokes -15.63%. Total +570 lines."
  pr:
    number: null
    url: null
    status: null  # draft | open | merged | closed
    merged_at: null

dependencies:
  requires:
    - "T-06-01-parity-methodology"  # ✅ Completed 2025-10-24
  blocks:
    - "T-02-02-sparse-index"
    - "T-03-01-core-commands"

deliverables:
  - "crates/cds-index/src/graph/parser.rs"
  - "crates/cds-index/src/graph/builder.rs"
  - "crates/cds-index/src/graph/traversal.rs"
  - "crates/cds-index/tests/graph_builder_tests.rs"
  - "tests/fixtures/repos/"

acceptance_criteria:
  - criterion: "Parses Python repositories and produces a graph with all 4 node types and 4 edge types"
    status: "in_progress"
    notes: "✅ All 4 node types implemented. ✅ All 4 edge types implemented. ✅ Parity harness validates against 6 repos. ⏳ Nodes/contains/inherits exact match. ❌ Imports/invokes exceed 2% variance."
  - criterion: "Fully-qualified names match LocAgent format (e.g., path/to/file.py::Class::method)"
    status: "in_progress"
    notes: "✅ FQN format implemented (filename:Class.method). ⏳ Validation ongoing via parity tests."
  - criterion: "Unit tests cover typical and edge cases (decorators, nested classes, async functions)"
    status: "in_progress"
    notes: "✅ Unit tests: 2 invoke edge tests. ✅ Integration: Parity harness for 6 repos. ⏳ Needs expansion to >80% coverage."
  - criterion: "Graph parity script reports ≤2% variance in node/edge counts vs. LocAgent baseline"
    status: "in_progress"
    notes: "✅ Parity harness running. ❌ Variance: imports +23.85%, invokes -15.63%. ⏳ Day 3: Implement re-exports + callee traversal."

worklog:
  base_path: ".artifacts/spec-tasks-T-02-01-graph-builder/worklogs/"
  entries:
    - date: "2025-10-24"
      summary: "worklogs/2025-10-24-work-summary.md"
      commits: "worklogs/2025-10-24-commit-log.md"
      notes: "worklogs/2025-10-24-notes.md"
    - date: "2025-10-25"
      summary: "worklogs/2025-10-25-work-summary.md"
      commits: "worklogs/2025-10-25-commit-log.md"
      notes: "worklogs/2025-10-25-notes.md"

metrics:
  estimated_hours: 40  # 5 days * 8 hours
  actual_hours: 13  # Day 1: 2h planning, Day 2: 8h implementation + 3h parity
  lines_added: 2634  # Core: 2064 + Parity session: 570
  lines_deleted: 40   # Core: 26 + Parity session: 14
  files_modified: 14  # Core: 12 + Parity session: 2 more (builder.rs again, graph_parity_tests.rs)
  tests_added: 3      # 2 unit tests + 1 integration test suite
  test_coverage: 0.20 # Estimated: ~20% (unit + integration)

comments:
  - date: "2025-10-24"
    author: "Rust Dev 1"
    text: "Task preparation complete. Spec review documented in 2025-10-24-notes.md. 6 baseline fixtures available (658 to 6,876 nodes). Ready to begin implementation."
  - date: "2025-10-25"
    author: "Rust Dev 1"
    text: "Day 2 implementation: Core graph builder complete with all 4 node/edge types. Implemented parser (426 lines), builder (1040 lines), traversal (64 lines), initial tests (232 lines). Total: ~1,964 lines of Rust code. Next: Expand unit tests and run parity validation."
  - date: "2025-10-25"
    author: "Rust Dev 1"
    text: "Day 2 parity session: Added parity harness (359 lines), refactored builder with AST-based imports (+159 lines). Parity results: nodes/contains/inherits exact match ✅, imports +23.85% ❌, invokes -15.63% ❌. Root causes: missing re-exports, need graph-based callee traversal. Next: Implement __init__.py awareness and LocAgent's find_all_possible_callee."

related_artifacts:
  - type: "parity_baseline"
    path: "tests/fixtures/parity/golden_outputs/graph_locagent.json"
  - type: "parity_baseline"
    path: "tests/fixtures/parity/golden_outputs/graph_django__django-10914.json"
  - type: "parity_baseline"
    path: "tests/fixtures/parity/golden_outputs/graph_matplotlib__matplotlib-18869.json"
  - type: "parity_baseline"
    path: "tests/fixtures/parity/golden_outputs/graph_psf__requests-1963.json"
  - type: "parity_baseline"
    path: "tests/fixtures/parity/golden_outputs/graph_pytest-dev__pytest-11143.json"
  - type: "parity_baseline"
    path: "tests/fixtures/parity/golden_outputs/graph_scikit-learn__scikit-learn-10297.json"
  - type: "reference_implementation"
    path: "tmp/LocAgent/dependency_graph/build_graph.py"
  - type: "methodology"
    path: "docs/parity-validation-methodology.md"
